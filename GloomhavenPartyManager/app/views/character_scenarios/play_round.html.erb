<h3><%=@scenario.display%>: <%=image_tag @character.character_class.getIconImage, width: "50em"%> <%=@character.name%><small> Round <%=@scenario.current_round.number%></small></h3>
<%= form_with(url: update_loot_character_scenario_path(@character_scenario), method: :put, local: true) do |form| %>
  <div class="grid-x grid-margin-x grid-padding-x grid-padding-y grid-margin-y">
    <div class="cell small-12 medium-2">
      <b>Health:</b>
      <div class="input-group" style="height:2.5em">
        <%if @character_scenario.health > 0%>
          <div class="input-group-button">
            <%= button_tag(type: 'submit', class: "button", name: "health_minus") do %>
              <i class="fas fa-minus"></i>
            <% end %>
          </div>
        <%end%>
        <span class="input-group-label" style="width:5em"><%=@character_scenario.health%></span>
        <%if @character_scenario.health < @character_scenario.character.max_health %>
          <div class="input-group-button">
            <%= button_tag(type: 'submit', class: "button", name: "health_plus") do %>
              <i class="fas fa-plus"></i>
            <% end %>
          </div>
        <%end%>
      </div>
    </div>
    <div class="cell small-12 medium-2">
      <b>Experience:</b>
      <div class="input-group" style="height:2.5em">
        <%if @character_scenario.experience > 0%>
          <div class="input-group-button">
            <%= button_tag(type: 'submit', class: "button", name: "xp_minus") do %>
              <i class="fas fa-minus"></i>
            <% end %>
          </div>
        <%end%>
        <span class="input-group-label" style="width:5em"><%=@character_scenario.experience%></span>
        <div class="input-group-button">
          <%= button_tag(type: 'submit', class: "button", name: "xp_plus") do %>
            <i class="fas fa-plus"></i>
          <% end %>
        </div>
      </div>
    </div>
    <div class="cell small-12 medium-2">
      <b>Gold:</b>
      <div class="input-group" style="height:2.5em">
        <%if @character_scenario.gold > 0%>
          <div class="input-group-button">
            <%= button_tag(type: 'submit', class: "button", name: "gold_minus") do %>
              <i class="fas fa-minus"></i>
            <% end %>
          </div>
        <%end%>
        <span class="input-group-label" style="width:5em"><%=@character_scenario.gold%></span>
        <div class="input-group-button">
          <%= button_tag(type: 'submit', class: "button", name: "gold_plus") do %>
            <i class="fas fa-plus"></i>
          <% end %>
        </div>
      </div>
    </div>
    <div class="cell small-12 medium-6">
      <b>Status Effects:</b><br />
      <%poison = @character_scenario.is_poison ? "alert" : "tertiary"%>
      <%wound = @character_scenario.is_wound ? "alert" : "tertiary"%>
      <%immobilize = @character_scenario.is_immobilize ? "alert" : "tertiary"%>
      <%disarm = @character_scenario.is_disarm ? "alert" : "tertiary"%>
      <%stun = @character_scenario.is_stun ? "alert" : "tertiary"%>
      <%muddle = @character_scenario.is_muddle ? "alert" : "tertiary"%>
      <%invisible = @character_scenario.is_invisible ? "success" : "tertiary"%>
      <%strengthen = @character_scenario.is_strengthen ? "success" : "tertiary"%>
      <%= button_tag(type: 'submit', class: "button #{poison}", name: "poison") do %>
        <i class="fas fa-skull-crossbones"></i>
      <% end %>
      <%= button_tag(type: 'submit', class: "button #{wound}", name: "wound") do %>
        <i class="fas fa-fire"></i>
      <% end %>
      <%= button_tag(type: 'submit', class: "button #{immobilize}", name: "immobilize") do %>
        <i class="fas fa-walking"></i>
      <% end %>
      <%= button_tag(type: 'submit', class: "button #{disarm}", name: "disarm") do %>
        <i class="fas fa-hand-sparkles"></i>
      <% end %>
      <%= button_tag(type: 'submit', class: "button #{stun}", name: "stun") do %>
        <i class="fas fa-bahai"></i>
      <% end %>
      <%= button_tag(type: 'submit', class: "button #{muddle}", name: "muddle") do %>
        <i class="fas fa-question"></i>
      <% end %>
      <%= button_tag(type: 'submit', class: "button #{invisible}", name: "invisible") do %>
        <i class="fas fa-eye-slash"></i>
      <% end %>
      <%= button_tag(type: 'submit', class: "button #{strengthen}", name: "strengthen") do %>
        <i class="fas fa-dumbbell"></i>
      <% end %>
    </div>
  </div>
<%end%>
<%if @character_round.nil?%>
  <%if @character.ability_cards.chosen.discarded.count > 1%>
    <div class="grid-x grid-margin-x align-spaced">
      <div class="cell small-12 medium-3">
        <%=render "character_scenarios/play_round_partials/long_rest"%>
      </div>
      <div class="cell small-12 medium-3">
        <%= form_with(url: short_rest_path ,method: :get, local: true) do |form| %>
          <%=form.hidden_field :character_scenario_id, value: @character_scenario.id%>
          <%=form.submit "Short Rest", class: "button expanded"%>
        <%end%>
      </div>
    </div>
  <%end%>
  <div class="grid-x grid-margin-x grid-padding-x grid-margin-y grid-padding-y">
    <div class="cell small-12 medium-3">
      <div class="card card-padding">
        <h5>Discarded Cards</h5>
        <%@character.ability_cards.chosen.discarded.each do |card|%>
          <li>
            <a href="javascript:;" data-open="ability_cards_<%=card.id%>">
              <%=card.name%>
            </a>
          </li>
          <div class="tiny reveal" id="ability_cards_<%=card.id%>" data-reveal>
            <%=render card, card: card%>
            <button class="close-button" data-close aria-label="Close modal" type="button">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        <%end%>
      </div>
      <div class="card card-padding">
        <h5>Lost Cards</h5>
        <%@character.ability_cards.chosen.lost.each do |card|%>
          <li>
            <a href="javascript:;" data-open="ability_cards_<%=card.id%>">
              <%=card.name%>
            </a>
          </li>
          <div class="tiny reveal" id="ability_cards_<%=card.id%>" data-reveal>
            <%=render card, card: card%>
            <button class="close-button" data-close aria-label="Close modal" type="button">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        <%end%>
      </div>
      <div class="card card-padding">
        <h5>Discarded Items</h5>
        <%@character.items.active.discarded.each do |item|%>
          <li>
            <a href="javascript:;" data-open="items_<%=item.id%>">
              <%=item.name%>
            </a>
          </li>
          <div class="tiny reveal" id="items_<%=item.id%>" data-reveal>
            <%=image_tag item.getImage%>
            <button class="close-button" data-close aria-label="Close modal" type="button">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        <%end%>
      </div>
      <div class="card card-padding">
        <h5>Lost Items</h5>
        <%@character.items.active.lost.each do |item|%>
          <li>
            <a href="javascript:;" data-open="items_<%=item.id%>">
              <%=item.name%>
            </a>
          </li>
          <div class="tiny reveal" id="items_<%=item.id%>" data-reveal>
            <%=image_tag item.getImage%>
            <button class="close-button" data-close aria-label="Close modal" type="button">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        <%end%>
      </div>
    </div>
    <div class="cell small-12 medium-8">
      <h4>Choose your Cards</h4><br />
      <%= form_with(url: choose_abilities_character_round_path, method: :put, local: true) do |form| %>
        <%=form.hidden_field :round_id, value: @round.id%>
        <%=form.hidden_field :character_scenario_id, value: @character_scenario.id%>
        <%if session[:short_rest]%>
          <%=form.hidden_field :short_rest, value: true%>
        <%else%>
          <%=form.hidden_field :short_rest, value: false%>
        <%end%>
        <div class="grid-x grid-padding-x">
        <%@character.ability_cards.chosen.available.each do |card|%>
          <div class="cell small-12 medium-3">
            <div class="grid-x">
              <div class="cell auto callout warning">
                <b><%=card.name%></b><br />
                <%=radio_button_tag :first_card, card.id, nil, required: 'required' %> <label for="first_card_<%=card.id%>" >First</label><br />
                <%=radio_button_tag :second_card, card.id, nil, required: 'required' %> <label for="second_card_<%=card.id%>">Second</label>
                <%form.check_box :played_ability_cards_id, { multiple: true }, card.id, false%>
              </div>
              <a href="javascript:;" data-open="ability_cards_<%=card.id%>">
                <%=render card, card: card%>
              </a>
              <br />
              <div class="tiny reveal" id="ability_cards_<%=card.id%>" data-reveal>
                <%=render card, card: card%>
                <button class="close-button" data-close aria-label="Close modal" type="button">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            </div>
          </div>
        <%end%>
        </div>
        <%=form.submit "Confirm Cards", class: "button expanded"%>
      <%end%>
    </div>
  </div>
<%else%>

  <div class="grid-x grid-margin-x grid-padding-x">
    <div class="cell small-12 medium-6 card">
      <%=render "character_scenarios/play_round_partials/play_ability_cards"%>
    </div>
    <div class="cell small-12 medium-6 card">
      <%=render "character_scenarios/play_round_partials/active"%>
    </div>
    <div class="cell small-12 card">
      draw deck? << buttons to add various cards (bless, curse, +1, -1, etc (popup)), see drawn cards
    </div>
    <div class="cell small-12 card">
      <%=render "character_scenarios/play_round_partials/items"%>
    </div>
    <div class="cell small-12 card">
      <%=render "character_scenarios/play_round_partials/available"%>
    </div>
    <div class="cell small-12 medium-6 card">
      <%=render "character_scenarios/play_round_partials/discarded"%>
    </div>
    <div class="cell small-12 medium-6 card">
      <%=render "character_scenarios/play_round_partials/lost"%>
    </div>

    <div class="cell small-12 medium-6 card">
      <%=render "character_scenarios/play_round_partials/discarded_items"%>
    </div>
    <div class="cell small-12 medium-6 card">
      <%=render "character_scenarios/play_round_partials/lost_items"%>
    </div>
  </div>
<%end%>
